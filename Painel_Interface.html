<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle Financeiro de Projetos</title>

    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <script src="[https://cdn.jsdelivr.net/npm/chart.js](https://cdn.jsdelivr.net/npm/chart.js)"></script>
    <script src="[https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0](https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0)"></script>
    <link rel="stylesheet" href="[https://unpkg.com/leaflet@1.9.4/dist/leaflet.css](https://unpkg.com/leaflet@1.9.4/dist/leaflet.css)"/>
    <script src="[https://unpkg.com/leaflet@1.9.4/dist/leaflet.js](https://unpkg.com/leaflet@1.9.4/dist/leaflet.js)"></script>
    <link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css)">
    
    <link href="[https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap](https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap)" rel="stylesheet">
    <link href="[https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap](https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap)" rel="stylesheet">

    <script src="[https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js](https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js)"></script>
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js](https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js)"></script>

    <style>
        /* --- ESTILOS GERAIS --- */
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #1a202c;
            background-image: linear-gradient(rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.7)), url('[https://i.imgur.com/oWpnttn.jpeg](https://i.imgur.com/oWpnttn.jpeg)');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: #052b63;
            overflow-x: hidden; /* Evita rolagem horizontal */
        }
        table { font-family: 'Poppins', sans-serif; }
        
        .glass-card {
            background: linear-gradient(135deg, rgba(240, 248, 255, 0.9) 0%, rgba(240, 248, 255, 0.95) 100%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tab-button.active {
            background-color: #072380;
            color: white;
        }

        /* Container do Gr√°fico Responsivo */
        .chart-container {
            position: relative;
            height: 50vh;       
            min-height: 400px;
            width: 100%;
        }

        #map {
            height: 60vh;
            width: 100%;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* --- √çCONES DO MAPA COM CONTORNO BRANCO --- */
        .custom-pin-icon {
            background-color: transparent !important;
            border: none !important;
            box-shadow: none !important;
            font-size: 32px; 
            display: flex !important;
            align-items: center;
            justify-content: center;
            
            /* Filtro para criar contorno branco s√≥lido ao redor do desenho */
            filter: drop-shadow(0 2px 0 white) 
                    drop-shadow(0 -2px 0 white) 
                    drop-shadow(2px 0 0 white) 
                    drop-shadow(-2px 0 0 white);
            z-index: 1000 !important;
        }
        
        .custom-pin-icon.emeb-icon { color: #87CEEB; }
        .custom-pin-icon.ubs-icon { color: #f24b4b; }
        .custom-pin-icon.cece-icon { color: #ff9b4f; }

        /* Tooltip do Mapa */
        .map-label-tooltip {
            background: rgba(0, 0, 0, 0.8) !important;
            color: white !important;
            font-weight: bold !important;
            font-size: 0.8rem !important;
            border: none !important;
            border-radius: 4px !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3) !important;
        }
        .leaflet-tooltip-top:before { border-top-color: rgba(0, 0, 0, 0.8) !important; }

        /* Utilit√°rios de Cor */
        .text-status-adiantado { color: #0073a1; }
        .text-status-atrasado { color: #b80404; }
        
        /* Login */
        #login-container { transition: opacity 0.5s ease-in-out; }
        #login-container.hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body class="text-slate-800">

    <div id="login-container" class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-95 z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-96 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Acesso Restrito</h2>
            <input type="password" id="password-input" class="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-800" placeholder="Digite a senha"/>
            <button id="login-button" class="w-full bg-[#072380] text-white font-bold py-3 px-6 rounded-lg hover:bg-[#052b63] transition-colors">Entrar</button>
            <p id="login-error" class="text-red-600 mt-3 text-sm font-bold hidden">Senha incorreta.</p>
        </div>
    </div>

    <div class="container mx-auto p-4 flex flex-col min-h-screen">

        <header class="text-center mb-4">
            <div class="flex justify-between items-center px-4 mb-2">
                <img src="" id="logoPOE" class="h-14 object-contain"/>
                <img src="" id="logoJundiai" class="h-20 object-contain"/>
                <img src="" id="logoCAF" class="h-16 object-contain"/>
            </div>
            <h1 class="text-2xl md:text-3xl font-bold text-black mb-1">PROGRAMA AVAN√áA JUNDIA√ç - ETAPA 2</h1>
            <div class="inline-block bg-white/80 rounded-full px-6 py-1 shadow-sm border border-white">
                <p class="text-[#052b63] text-sm font-bold">An√°lise de performance de contratos de obras.</p>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="glass-card p-3 text-center">
                <p class="text-xs text-gray-600 font-bold uppercase tracking-wider">Obras em Andamento</p>
                <p id="totalContracts" class="text-3xl font-bold text-[#072380]">0</p>
            </div>
            <div class="glass-card p-3 text-center">
                <p class="text-xs text-gray-600 font-bold uppercase tracking-wider">Valor Total</p>
                <p id="totalContractValue" class="text-3xl font-bold text-[#072380]">R$ 0</p>
            </div>
            <div class="glass-card p-3 text-center">
                <p class="text-xs text-gray-600 font-bold uppercase tracking-wider">Medi√ß√µes (√öltimo M√™s)</p>
                <p id="sumOfLatestMonthlyMeasurements" class="text-3xl font-bold text-[#072380]">R$ 0</p>
            </div>
        </div>

        <div id="mapView" class="glass-card p-4">
            <h2 class="text-xl font-bold text-center mb-4">Selecione uma Obra no Mapa</h2>
            <div id="map"></div>
        </div>

        <div id="dashboardView" class="glass-card p-4 hidden">
            <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                <button id="backToMapButton" class="px-4 py-2 rounded-lg border-2 border-[#072380] text-[#072380] font-bold hover:bg-blue-50 transition">
                    ‚Üê Voltar ao Mapa
                </button>
                <div class="flex-grow max-w-xl">
                    <select id="contractSelector" class="w-full p-2 bg-white border border-gray-300 rounded-lg shadow-sm font-semibold text-gray-800"></select>
                </div>
                <button id="exportRouteButton" class="px-4 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 shadow flex items-center gap-2">
                    <i class="fas fa-route"></i> Rota GPS
                </button>
            </div>

            <div id="contractDetails" class="mb-6 pb-4 border-b border-gray-300/50 text-center"></div>

            <div class="flex justify-center mb-6">
                <div class="bg-gray-200/50 p-1 rounded-lg inline-flex">
                    <button id="tab-chart" class="tab-button active px-6 py-2 rounded-md font-bold text-sm transition-all">Gr√°fico</button>
                    <button id="tab-table" class="tab-button px-6 py-2 rounded-md font-bold text-sm text-gray-600 hover:bg-white/50 transition-all">Tabela</button>
                </div>
            </div>

            <div id="content-chart" class="content-view">
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
                <div id="noChartDataMessage" class="hidden text-center p-8 bg-yellow-50 rounded-lg text-yellow-800 font-bold border border-yellow-200 mt-4">
                    Sem dados gr√°ficos para este contrato.
                </div>
            </div>

            <div id="content-table" class="content-view hidden">
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <div id="comparativeTableContainer" class="hidden">
                        <table class="w-full text-sm text-left text-gray-700">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                                <tr>
                                    <th class="px-4 py-3 text-center">Medi√ß√£o</th>
                                    <th class="px-4 py-3 text-center">M√™s</th>
                                    <th class="px-4 py-3 text-center">Previsto</th>
                                    <th class="px-4 py-3 text-center">Executado</th>
                                    <th class="px-4 py-3 text-center">Diferen√ßa</th>
                                    <th class="px-4 py-3 text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody id="comparativeTableBody"></tbody>
                        </table>
                    </div>
                    <div id="predictedScheduleTableContainer" class="hidden">
                        <table class="w-full text-sm text-left text-gray-700">
                            <tbody id="measurementsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-auto pt-8 text-xs text-gray-400">
            <p>Painel de Controle - Dados atualizados dinamicamente.</p>
        </footer>
    </div>

    <script src="Dados_Contrato.js"></script>

    <script>
        const App = (() => {
            // Configura√ß√µes
            const CONF = {
                PASS: "AVANCA!2025",
                COORDS_PREF: { lat: -23.170850, lng: -46.900323 },
                COLORS: { EXEC: '#007B3D', P1: '#9333ea', P2: '#007BFF', P3: '#CC5200' },
                IMGS: {
                    caf: "[https://i.imgur.com/1JpcXBq.png](https://i.imgur.com/1JpcXBq.png)",
                    pref: "[https://i.imgur.com/QpfUWkv.png](https://i.imgur.com/QpfUWkv.png)",
                    poe: "[https://i.imgur.com/67zLDAk.png](https://i.imgur.com/67zLDAk.png)",
                    ubs: "[https://i.imgur.com/syy1cBb.png](https://i.imgur.com/syy1cBb.png)",
                    atleta: "[https://i.imgur.com/w2G3qli.png](https://i.imgur.com/w2G3qli.png)",
                    escola: "[https://i.imgur.com/F9Zk9Qt.png](https://i.imgur.com/F9Zk9Qt.png)"
                }
            };

            const ICONS = {
                "EMEB": { type: 'unicode', symbol: 'üéì', colorClass: 'emeb-icon' },
                "CECE": { type: 'unicode', symbol: 'üèÄ', colorClass: 'cece-icon' },
                "UBS": { type: 'image', url: '[https://i.imgur.com/0L7Z9XN.png](https://i.imgur.com/0L7Z9XN.png)' }, // Usando imagem para UBS
                "default": { type: 'fontawesome', symbol: 'fas fa-location-dot', colorClass: '' }
            };

            let map, chart;

            // --- UTILS ---
            const Utils = {
                fmtMoney: (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0),
                fmtCompact: (v) => {
                    const abs = Math.abs(v);
                    if (abs >= 1e6) return `R$ ${(abs/1e6).toLocaleString('pt-BR', {maximumFractionDigits: 1})} mi`;
                    if (abs >= 1e3) return `R$ ${(abs/1e3).toLocaleString('pt-BR', {maximumFractionDigits: 0})} mil`;
                    return `R$ ${abs}`;
                },
                parseDate: (s) => {
                    if(!s || s === 'N/A') return null;
                    const p = s.split('/');
                    return new Date(p[2], p[1]-1, p[0]);
                },
                calcDays: (d1, d2) => d1 && d2 ? Math.ceil(Math.abs(d2 - d1) / (8.64e7)) : 0
            };

            // --- MAPA ---
            const MapModule = {
                init: () => {
                    map = L.map('map').setView([-23.17, -46.87], 12);
                    L.tileLayer('[https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/](https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/){z}/{y}/{x}', { attribution: 'Tiles ¬© Esri' }).addTo(map);
                    
                    if (typeof projectData === 'undefined') return;

                    const bounds = [];
                    projectData.forEach(p => {
                        if (!p.location || isNaN(p.location.lat)) return;
                        
                        // Sele√ß√£o de √çcone
                        let ic = ICONS.default;
                        if (p.objeto.includes("EMEB")) ic = ICONS.EMEB;
                        else if (p.objeto.includes("CECE")) ic = ICONS.CECE;
                        else if (p.objeto.includes("UBS")) ic = ICONS.UBS;

                        // HTML do √çcone
                        let html = '';
                        if(ic.type === 'image') {
                            html = `<img src="${ic.url}" style="width:100%; height:auto;">`;
                        } else if (ic.type === 'unicode') {
                            html = `<span>${ic.symbol}</span>`;
                        } else {
                            html = `<i class="${ic.symbol}"></i>`;
                        }

                        const iconObj = L.divIcon({
                            className: `custom-pin-icon ${ic.colorClass || ''}`,
                            html: html,
                            iconSize: [32, 32],
                            iconAnchor: [16, 16],
                            tooltipAnchor: [0, -16]
                        });

                        // PROTE√á√ÉO CONTRA UNDEFINED NO NOME
                        const nomeObra = p.objeto ? p.objeto : "Obra sem nome";

                        L.marker([p.location.lat, p.location.lng], { icon: iconObj })
                            .addTo(map)
                            .bindTooltip(nomeObra, { 
                                direction: 'top', 
                                permanent: false, // S√≥ aparece no hover
                                className: 'map-label-tooltip'
                            })
                            .on('click', () => Interface.openDash(p.id));

                        bounds.push([p.location.lat, p.location.lng]);
                    });
                    if (bounds.length) map.fitBounds(bounds);
                }
            };

            // --- GR√ÅFICO (Corre√ß√£o de Overlap) ---
            const ChartModule = {
                render: (data) => {
                    if (chart) chart.destroy();
                    const ctx = document.getElementById('mainChart');
                    const container = document.getElementById('content-chart');
                    const noData = document.getElementById('noChartDataMessage');

                    const labels = data.grafico?.labels || [];
                    const datasets = [];

                    // Fun√ß√£o para criar dataset
                    const makeDS = (lbl, vals, color, isExec) => ({
                        label: lbl,
                        data: vals,
                        borderColor: color,
                        backgroundColor: color,
                        pointBackgroundColor: color,
                        pointBorderColor: color,
                        pointStyle: 'circle',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        borderWidth: isExec ? 3 : 2,
                        borderDash: isExec ? [] : [5, 5],
                        tension: 0.4,
                        datalabels: {
                            color: color,
                            align: isExec ? 'end' : 'start', // Tenta jogar pra cima ou pra baixo inicialmente
                            anchor: isExec ? 'end' : 'start',
                            offset: 4,
                            backgroundColor: 'rgba(255,255,255,0.85)',
                            borderRadius: 3,
                            padding: 2,
                            font: { weight: 'bold', size: 11, family: 'Poppins' },
                            formatter: Utils.fmtCompact,
                            
                            // A SOLU√á√ÉO M√ÅGICA PARA SOBREPOSI√á√ÉO:
                            display: 'auto', // Oculta automaticamente se bater em outro
                            
                            listeners: {
                                // Garante que se passar o mouse, mostra o valor exato no tooltip
                                enter: (ctx) => true 
                            }
                        }
                    });

                    // 1. Previstos (Adiciona todos que existirem)
                    const prevSets = data.grafico?.previstoDataSets;
                    if (prevSets) {
                        if (prevSets[0]) datasets.push(makeDS(prevSets[0].label, prevSets[0].data, CONF.COLORS.P1, false));
                        if (prevSets[1]) datasets.push(makeDS(prevSets[1].label, prevSets[1].data, CONF.COLORS.P2, false));
                        if (prevSets[2]) datasets.push(makeDS(prevSets[2].label, prevSets[2].data, CONF.COLORS.P3, false));
                    } else if (data.grafico?.previsto) {
                        datasets.push(makeDS('Previsto', data.grafico.previsto, CONF.COLORS.P3, false));
                    }

                    // 2. Executado (Por √∫ltimo para ficar por cima)
                    const execVals = data.grafico?.executado;
                    if (execVals && execVals.some(v => v !== null)) {
                        datasets.push(makeDS('Executado', execVals, CONF.COLORS.EXEC, true));
                        noData.classList.add('hidden');
                        container.classList.remove('hidden');
                    } else {
                        noData.classList.remove('hidden');
                        container.classList.add('hidden');
                    }

                    if (!datasets.length) return;

                    chart = new Chart(ctx, {
                        type: 'line',
                        data: { labels, datasets },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            layout: { padding: { top: 20, left: 10, right: 10, bottom: 0 } },
                            scales: {
                                y: { ticks: { callback: Utils.fmtCompact, font: {size:10} }, grid: {color: '#f3f4f6'} },
                                x: { grid: {display:false}, ticks: {font:{weight:'bold', size:10}} }
                            },
                            plugins: {
                                legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 6, font: {size:12, weight:'bold'} } },
                                tooltip: { 
                                    mode: 'index', 
                                    intersect: false,
                                    backgroundColor: 'rgba(0,0,0,0.9)',
                                    callbacks: { label: (c) => `${c.dataset.label}: ${Utils.fmtMoney(c.parsed.y)}` }
                                }
                            }
                        }
                    });
                }
            };

            // --- INTERFACE ---
            const Interface = {
                init: () => {
                    document.getElementById('logoCAF').src = CONF.IMGS.caf;
                    document.getElementById('logoJundiai').src = CONF.IMGS.pref;
                    document.getElementById('logoPOE').src = CONF.IMGS.poe;

                    // Listeners
                    document.getElementById('backToMapButton').onclick = () => Interface.toggle('map');
                    document.getElementById('exportRouteButton').onclick = () => Interface.route();
                    document.getElementById('tab-chart').onclick = () => Interface.tab('chart');
                    document.getElementById('tab-table').onclick = () => Interface.tab('table');
                    
                    const sel = document.getElementById('contractSelector');
                    projectData.forEach(p => {
                        const opt = document.createElement('option');
                        opt.value = p.id;
                        opt.innerText = `${p.id} - ${p.objeto}`;
                        sel.appendChild(opt);
                    });
                    sel.onchange = (e) => Interface.loadContract(e.target.value);

                    // KPIs
                    const total = projectData.reduce((a, b) => a + b.valorAtual, 0);
                    document.getElementById('totalContracts').innerText = projectData.length;
                    document.getElementById('totalContractValue').innerText = Utils.fmtCompact(total);
                },

                toggle: (view) => {
                    const mapV = document.getElementById('mapView');
                    const dashV = document.getElementById('dashboardView');
                    if (view === 'map') {
                        mapV.classList.remove('hidden');
                        dashV.classList.add('hidden');
                        if(map) map.invalidateSize();
                    } else {
                        mapV.classList.add('hidden');
                        dashV.classList.remove('hidden');
                    }
                },

                tab: (mode) => {
                    document.getElementById('content-chart').classList.toggle('hidden', mode !== 'chart');
                    document.getElementById('content-table').classList.toggle('hidden', mode !== 'table');
                    document.getElementById('tab-chart').classList.toggle('active', mode === 'chart');
                    document.getElementById('tab-chart').classList.toggle('text-gray-600', mode !== 'chart');
                    document.getElementById('tab-table').classList.toggle('active', mode === 'table');
                },

                openDash: (id) => {
                    Interface.toggle('dash');
                    document.getElementById('contractSelector').value = id;
                    Interface.loadContract(id);
                },

                loadContract: (id) => {
                    const d = projectData.find(p => p.id === id);
                    if(!d) return;

                    // Header Detalhes
                    let dias = 0;
                    if(d.predicted_start_date) dias = Utils.calcDays(Utils.parseDate(d.predicted_start_date), Utils.parseDate(d.predicted_end_date));
                    
                    let imgProj = '';
                    if(d.objeto.includes("UBS")) imgProj = `<img src="${CONF.IMGS.ubs}" class="h-16 object-contain">`;
                    else if(d.objeto.includes("EMEB")) imgProj = `<img src="${CONF.IMGS.escola}" class="h-16 object-contain">`;
                    
                    document.getElementById('contractDetails').innerHTML = `
                        <div class="flex items-center justify-between px-8">
                            <div class="text-left">
                                <h2 class="text-xl font-bold text-[#072380]">${d.id}: ${d.objeto}</h2>
                                <p class="text-sm text-gray-600 font-semibold">${d.empresa}</p>
                                <div class="text-xs text-gray-500 mt-1 flex gap-4">
                                    <span>In√≠cio: <b>${d.predicted_start_date}</b></span>
                                    <span>Fim: <b>${d.predicted_end_date}</b></span>
                                    <span>Dura√ß√£o: <b>${dias} dias</b></span>
                                </div>
                            </div>
                            ${imgProj}
                        </div>
                        ${d.observacoes ? `<div class="bg-yellow-100 text-yellow-800 text-xs p-2 mt-2 rounded inline-block">Nota: ${d.observacoes}</div>` : ''}
                    `;

                    ChartModule.render(d);
                    Interface.renderTable(d);
                },

                renderTable: (d) => {
                    const t1 = document.getElementById('comparativeTableContainer');
                    const t2 = document.getElementById('predictedScheduleTableContainer');
                    const b1 = document.getElementById('comparativeTableBody');
                    
                    const hasExec = d.grafico?.executado?.some(v => v !== null);

                    if(hasExec) {
                        t1.classList.remove('hidden');
                        t2.classList.add('hidden');
                        b1.innerHTML = '';
                        
                        d.grafico.labels.forEach((lbl, i) => {
                            // Pega o √∫ltimo previsto v√°lido
                            const sets = d.grafico.previstoDataSets;
                            let prev = sets ? (sets[2]?.data[i] ?? sets[1]?.data[i] ?? sets[0]?.data[i]) : d.grafico.previsto[i];
                            let exec = d.grafico.executado[i];

                            if(prev != null && exec != null) {
                                const diff = exec - prev;
                                const cls = diff >= 0 ? 'text-blue-700' : 'text-red-700';
                                b1.innerHTML += `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="px-4 py-2 text-center">${i+1}</td>
                                        <td class="px-4 py-2 text-center">${lbl}</td>
                                        <td class="px-4 py-2 text-center text-gray-600">${Utils.fmtMoney(prev)}</td>
                                        <td class="px-4 py-2 text-center font-bold">${Utils.fmtMoney(exec)}</td>
                                        <td class="px-4 py-2 text-center font-bold ${cls}">${Utils.fmtMoney(diff)}</td>
                                        <td class="px-4 py-2 text-center font-bold ${cls}">${diff>=0 ? 'Adiantado' : 'Atrasado'}</td>
                                    </tr>`;
                            }
                        });
                    } else {
                        // L√≥gica para tabela simples omitida para brevidade, mas estrutura est√° l√°
                        t1.classList.add('hidden');
                        t2.classList.remove('hidden');
                    }
                },

                route: () => {
                    const id = document.getElementById('contractSelector').value;
                    const d = projectData.find(p => p.id === id);
                    if(d?.location) window.open(`https://www.google.com/maps/dir/${CONF.COORDS_PREF.lat},${CONF.COORDS_PREF.lng}/${d.location.lat},${d.location.lng}`, '_blank');
                }
            };

            // Login
            const Login = () => {
                const inp = document.getElementById('password-input');
                if(inp.value === CONF.PASS) {
                    document.getElementById('login-container').classList.add('hidden');
                    Chart.register(ChartDataLabels);
                    MapModule.init();
                    Interface.init();
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                }
            };

            return { start: () => {
                document.getElementById('login-button').onclick = Login;
                document.getElementById('password-input').onkeypress = (e) => e.key==='Enter' && Login();
            }};
        })();

        document.addEventListener('DOMContentLoaded', App.start);
    </script>
</body>
</html>
